<?xml version="1.0" encoding="UTF-8"?>
<Schema name="datachile">
  <Dimension name="Date" type="TimeDimension">
    <Hierarchy hasAll="true" primaryKey="id">
      <Table schema="public" name="dim_date" />
      <Level column="the_year" levelType="TimeYears" name="Year" type="Numeric" uniqueMembers="true"/>
      <Level column="month_of_year" levelType="TimeMonths" name="Month" type="Numeric" uniqueMembers="false" />
      <Level column="day_of_month" levelType="TimeDays" name="Day" type="Numeric" uniqueMembers="false" />
    </Hierarchy>
  </Dimension>

  <Dimension name="Geography">
    <Hierarchy hasAll="true" primaryKey="id">
      <Table name="dim_comunas" schema="public" />
      <Level name="Region" column="region_id" nameColumn="region_name" uniqueMembers="true" />
      <Level name="Comuna" column="comuna_datachile_id" nameColumn="comuna_name" uniqueMembers="false" />
    </Hierarchy>
  </Dimension>

  <Dimension name="Country">
    <Hierarchy hasAll="true" primaryKey="country_code">
      <Table name="dim_countries_new" schema="public" />
      <Level name="Region" column="region_code" nameColumn="region" uniqueMembers="true" />
      <Level name="Subregion" column="sub_region_code" nameColumn="sub_region" uniqueMembers="true" />
      <Level name="Country" column="country_code" nameColumn="country_name" uniqueMembers="true">
          <Annotations>
              <Annotation name="es_caption">Country ES</Annotation>
          </Annotations>
          <Property name="Country ES" column="es_country_name" />
      </Level>
    </Hierarchy>
  </Dimension>

  <Dimension name="HS">
    <Hierarchy hasAll="true" primaryKey="level3">
      <Table name="hs_levels" schema="economy" />
      <Level name="HS0" column="level0" nameColumn="level0_name" uniqueMembers="true">
        <Annotations>
          <Annotation name="es_caption">HS0 ES</Annotation>
        </Annotations>
        <Property name="HS0 ES" column="es_level0_description" />
      </Level>
      <Level name="HS2" column="level1" nameColumn="level1_name" uniqueMembers="false" />
      <Level name="HS4" column="level2" nameColumn="level2_name" uniqueMembers="false" />
      <Level name="HS6" column="level3" nameColumn="level3_name" uniqueMembers="false" />
    </Hierarchy>
  </Dimension>

  <Dimension name="ISICrev4">
    <Hierarchy hasAll="true" primaryKey="level4">
      <Table name="dim_isic" schema="public" />
      <Level name="Level 1" column="level1" nameColumn="level1_description" uniqueMembers="true">
        <Annotations>
          <Annotation name="es_caption">Level 1 ES</Annotation>
        </Annotations>
        <Property name="Level 1 ES" column="es_level1_description" />
      </Level>
      <Level name="Level 2" column="level2" nameColumn="level2_description" uniqueMembers="false">
        <Annotations>
          <Annotation name="es_caption">Level 2 ES</Annotation>
        </Annotations>
        <Property name="Level 2 ES" column="es_level2_description" />
      </Level>
      <Level name="Level 3" column="level3" nameColumn="level3_description" uniqueMembers="false">
        <Annotations>
          <Annotation name="es_caption">Level 3 ES</Annotation>
        </Annotations>
        <Property name="Level 3 ES" column="es_level3_description" />
      </Level>
      <Level name="Level 4" column="level4" nameColumn="level4_description" uniqueMembers="false">
        <Annotations>
          <Annotation name="es_caption">Level 4 ES</Annotation>
        </Annotations>
        <Property name="Level 4 ES" column="es_level4_description" />
      </Level>
    </Hierarchy>
  </Dimension>

  <Dimension name="Sex">
    <Hierarchy hasAll="true" primaryKey="sex_id">
        <InlineTable alias="dim_sex">
          <ColumnDefs>
            <ColumnDef name="sex_id" type="Numeric"/>
            <ColumnDef name="description" type="String"/>
            <ColumnDef name="es_description" type="String"/>
          </ColumnDefs>
          <Rows>
            <Row>
              <Value column="sex_id">0</Value>
              <Value column="description">Male</Value>
              <Value column="es_description">Masculino</Value>
            </Row>
            <Row>
              <Value column="sex_id">1</Value>
              <Value column="description">Female</Value>
              <Value column="es_description">Femenino</Value>
            </Row>
          </Rows>
        </InlineTable>
        <Level name="Sex" column="sex_id" nameColumn="description" uniqueMembers="true">
          <Annotations>
            <Annotation name="es_caption">Description ES</Annotation>
          </Annotations>
          <Property name="Description ES" column="es_description" />
        </Level>
    </Hierarchy>
  </Dimension>

  <Cube name="exports">
    <Table name="pg_exports_grouped" schema="economy" />

    <DimensionUsage name="Date" source="Date" foreignKey="date_id" />
    <DimensionUsage name="Destination Country" source="Country" foreignKey="country_dest_id" />
    <DimensionUsage name="Geography" source="Geography" foreignKey="exporter_comuna_id" />
    <DimensionUsage name="Export HS" source="HS" foreignKey="hs_level3" />

    <!-- Measure name="Q Traded" column="q_traded" aggregator="sum" / -->
    <Measure name="FOB US" column="fob_us" aggregator="sum" />
    <Measure name="rca_internal" column="region_rca" aggregator="min" visible="false" />

    <CalculatedMember name="RCA" dimension="Measures">
      <Formula>
        CASE
          WHEN [Geography].Level is [Geography].[Region] AND [Export HS].Level is [Export HS].[HS4] THEN [Measures].[rca_internal]
          ELSE Null
        END
      </Formula>
    </CalculatedMember>

    <CalculatedMember name="Geo Rank" dimension="Measures">
      <Formula>
        IIf(IsEmpty([Measures].[FOB US]),
            Null,
            Rank([Geography].CurrentMember,
                 Order([Geography].CurrentMember.Siblings,
                 Measures.[FOB US], BDESC)))
      </Formula>
    </CalculatedMember>

    <CalculatedMember name="Geo Rank Across Time" dimension="Measures">
      <Annotations>
        <Annotation name="description">Rank of this geography across all its siblings, by time</Annotation>
      </Annotations>
      <Formula>
        Iif(IsEmpty([Measures].[FOB US]),
            Null,
        Rank([Geography].CurrentMember,
          Order([Geography].CurrentMember.Siblings,
                Aggregate({[Date].CurrentMember}*{[Destination Country].[All Destination Countrys]}*{[Export HS].[All Export HSs]},
                          [Measures].[FOB US]),
                BDESC)))

      </Formula>
    </CalculatedMember>

  </Cube>

  <Cube name="imports">
    <Table name="pg_imports_grouped" schema="economy">
    </Table>
    <DimensionUsage name="Date" source="Date" foreignKey="date_id" />
    <DimensionUsage name="Origin Country" source="Country" foreignKey="country_origin_id" />
    <DimensionUsage name="Geography" source="Geography" foreignKey="importer_comuna_id" />
    <DimensionUsage name="Import HS" source="HS" foreignKey="hs_6digits" />

    <Measure name="CIF US" column="cif_us" aggregator="sum" />

    <CalculatedMember name="Geo Rank Across Time" dimension="Measures">
      <Annotations>
        <Annotation name="description">Rank of this geography across all its siblings, by time</Annotation>
      </Annotations>
      <Formula>
        Iif(IsEmpty([Measures].[CIF US]),
            Null,
            Rank([Geography].CurrentMember,
                 Order([Geography].CurrentMember.Siblings,
                       Aggregate({[Date].CurrentMember}*{[Origin Country].[All Origin Countrys]}*{[Import HS].[All Import HSs]},
                                 [Measures].[CIF US]),
                       BDESC)))

      </Formula>
    </CalculatedMember>
  </Cube>

  <Cube name="immigration">
    <Table name="fact_immigration_records" schema="public" />
    <DimensionUsage name="Date" source="Date" foreignKey="date_id" />
    <DimensionUsage name="Geography" source="Geography" foreignKey="comuna_datachile_id" />
    <DimensionUsage name="Origin Country" source="Country" foreignKey="country_code" />
    <DimensionUsage name="Sex" source="Sex" foreignKey="sex_id" />

    <Dimension name="Education" foreignKey="study_id">
      <Hierarchy hasAll="true">
        <InlineTable alias="education">
          <ColumnDefs>
            <ColumnDef name="id" type="Numeric"/>
            <ColumnDef name="description" type="String"/>
            <ColumnDef name="es_description" type="String"/>
          </ColumnDefs>
          <Rows>
            <Row>
              <Value column="id">1</Value>
              <Value column="description">Unknown</Value>
              <Value column="es_description">No Informa</Value>
            </Row>
            <Row>
              <Value column="id">2</Value>
              <Value column="description">Higher Education</Value>
              <Value column="es_description">Educación Universitaria</Value>
            </Row>
            <Row>
              <Value column="id">4</Value>
              <Value column="description">High School</Value>
              <Value column="es_description">Educación Media</Value>
            </Row>
            <Row>
              <Value column="id">5</Value>
              <Value column="description">Primary School</Value>
              <Value column="es_description">Educación Básica</Value>
            </Row>
            <Row>
              <Value column="id">6</Value>
              <Value column="description">Technical Education</Value>
              <Value column="es_description">Educación Técnica</Value>
            </Row>
            <Row>
              <Value column="id">7</Value>
              <Value column="description">Some Primary School</Value>
              <Value column="es_description">Educación Pre-Básica</Value>
            </Row>
            <Row>
              <Value column="id">8</Value>
              <Value column="description">None</Value>
              <Value column="es_description">Ninguno</Value>
            </Row>
          </Rows>
        </InlineTable>
        <Level name="Education" column="id" nameColumn="description" uniqueMembers="true">
          <Annotations>
            <Annotation name="es_caption">Description ES</Annotation>
          </Annotations>
          <Property name="Description ES" column="es_description" />
        </Level>
      </Hierarchy>
    </Dimension>

    <Dimension name="Activity" foreignKey="activity_id">
      <Hierarchy hasAll="true">
        <InlineTable alias="activity">
          <ColumnDefs>
            <ColumnDef name="id" type="Numeric"/>
            <ColumnDef name="description" type="String"/>
            <ColumnDef name="es_description" type="String"/>
          </ColumnDefs>
          <Rows>
            <Row>
              <Value column="id">1</Value>
              <Value column="description">Employee</Value>
              <Value column="es_description">Empleado</Value>
            </Row>
            <Row>
              <Value column="id">2</Value>
              <Value column="description">Student</Value>
              <Value column="es_description">Estudiante</Value>
            </Row>
            <Row>
              <Value column="id">3</Value>
              <Value column="description">Housewife</Value>
              <Value column="es_description">Dueña de Casa</Value>
            </Row>
            <Row>
              <Value column="id">4</Value>
              <Value column="description">Unemployed</Value>
              <Value column="es_description">Inactivo</Value>
            </Row>
            <Row>
              <Value column="id">5</Value>
              <Value column="description">Maid</Value>
              <Value column="es_description">Empleado Doméstico</Value>
            </Row>
            <Row>
              <Value column="id">6</Value>
              <Value column="description">No data</Value>
              <Value column="es_description">No Informa</Value>
            </Row>
            <Row>
              <Value column="id">7</Value>
              <Value column="description">Other activities</Value>
              <Value column="es_description">Otras Actividades</Value>
            </Row>
            <Row>
              <Value column="id">8</Value>
              <Value column="description">Religious</Value>
              <Value column="es_description">Religioso</Value>
            </Row>
            <Row>
              <Value column="id">9</Value>
              <Value column="description">Self-Employed</Value>
              <Value column="es_description">Trabajador por Cuenta Propia</Value>
            </Row>
            <Row>
              <Value column="id">10</Value>
              <Value column="description">No activity</Value>
              <Value column="es_description">Sin Actividad</Value>
            </Row>
            <Row>
              <Value column="id">11</Value>
              <Value column="description">Labourer</Value>
              <Value column="es_description">Obrero o Jornalero</Value>
            </Row>
            <Row>
              <Value column="id">12</Value>
              <Value column="description">Landlord</Value>
              <Value column="es_description">Rentista</Value>
            </Row>
            <Row>
              <Value column="id">13</Value>
              <Value column="description">Pilot</Value>
              <Value column="es_description">Tripulante</Value>
            </Row>
            <Row>
              <Value column="id">14</Value>
              <Value column="description">Businessperson</Value>
              <Value column="es_description">Empresario o Patrón</Value>
            </Row>
            <Row>
              <Value column="id">15</Value>
              <Value column="description">Retired</Value>
              <Value column="es_description">Jubilado o Pensionado</Value>
            </Row>
          </Rows>
        </InlineTable>
        <Level name="Activity" column="id" nameColumn="description" uniqueMembers="true">
          <Annotations>
            <Annotation name="es_caption">Description ES</Annotation>
          </Annotations>
          <Property name="Description ES" column="es_description" />
        </Level>
      </Hierarchy>
    </Dimension>

    <Measure name="Number of visas" column="birth_date" aggregator="count" />
    <Measure name="Average Age" column="age" aggregator="avg" />
  </Cube>

  <!-- NESI -->
  <Cube name="nesi_income">
    <Table name="fact_income_year_region_sex" schema="nesi" />
    <DimensionUsage name="Date" source="Date" foreignKey="date_id" />
    <DimensionUsage name="Geography" source="Geography" foreignKey="region_id" />
    <DimensionUsage name="Sex" source="Sex" foreignKey="sex_id" />
    
    <Measure name="P50" column="p50" aggregator="sum" />
    <Measure name="P70" column="p70" aggregator="sum" />
    <Measure name="CI P50" column="ci_p50" aggregator="sum" />
    <Measure name="CI P70" column="ci_p70" aggregator="sum" />
    <Measure name="CS P50" column="cs_p50" aggregator="sum" />
    <Measure name="CS P70" column="cs_p70" aggregator="sum" />
  </Cube>
  <!-- / NESI -->

  <Cube name="tax_data">
    <Table name="tax_data" schema="economy" />
    <DimensionUsage name="Date" source="Date" foreignKey="date_id" />
    <DimensionUsage name="Tax Geography" source="Geography" foreignKey="comuna_id" />
    <DimensionUsage name="ISICrev4" source="ISICrev4" foreignKey="ciiu4_ori" />

    <Measure name="Output" column="output" aggregator="sum" />
    <Measure name="Labour" column="labour" aggregator="sum" />
    <Measure name="Labour Cost" column="labour_cost" aggregator="sum" />
    <Measure name="Investment" column="investment" aggregator="sum" />
    <Measure name="Intermediates" column="intermediates" aggregator="sum" />

    <CalculatedMember name="Value Added" dimension="Measures">
      <Formula>
        [Measures].[Output] - [Measures].[Intermediates]
      </Formula>
    </CalculatedMember>

    <CalculatedMember name="Labour Productivity Based on Sales" dimension="Measures">
      <Formula>
        Iif([Measures].[Labour] > 0, [Measures].[Output]/[Measures].[Labour], Null)
      </Formula>
    </CalculatedMember>

    <CalculatedMember name="Labour Productivity Based on Value Added" dimension="Measures">
      <Formula>
        Iif([Measures].[Labour] > 0, [Measures].[Value Added] / [Measures].[Labour], Null)
      </Formula>
    </CalculatedMember>
  </Cube>

  <Cube name="rd_survey">
    <Table name="fact_rd_survey" schema="public" />

    <DimensionUsage name="Date" source="Date" foreignKey="date_id" />
    <DimensionUsage name="Headquarters Country" source="Country" foreignKey="headquarters_country_id" />

    <Dimension name="ISICrev4" foreignKey="CIIU_level1">
      <!-- dim_isic that only contains the first level -->
      <Hierarchy hasAll="true" primaryKey="level1">
        <View alias="isicrev4_level1">
          <SQL>SELECT distinct(level1), level1_description, es_level1_description from dim_isic</SQL>
        </View>
        <Level name="Level 1" column="level1" nameColumn="level1_description" uniqueMembers="true">
          <Annotations>
            <Annotation name="es_caption">Level 1 ES</Annotation>
          </Annotations>
          <Property name="Level 1 ES" column="es_level1_description" />
        </Level>
      </Hierarchy>
    </Dimension>

    <Dimension name="Business Type" foreignKey="org_juridica">
      <Hierarchy hasAll="true">
        <InlineTable alias="ownership_type">
          <ColumnDefs>
            <ColumnDef name="id" type="Numeric"/>
            <ColumnDef name="description" type="String"/>
            <ColumnDef name="es_description" type="String"/>
          </ColumnDefs>
          <Rows>
            <Row>
              <Value column="id">1</Value>
              <Value column="description">Individual</Value>
              <Value column="es_description">Personal Natural</Value>
            </Row>
            <Row>
              <Value column="id">2</Value>
              <Value column="description">Limited Liability Company</Value>
              <Value column="es_description">Sociedad de Responsabilidad Limitada</Value>
            </Row>
            <Row>
              <Value column="id">3</Value>
              <Value column="description">General Partnership</Value>
              <Value column="es_description">Sociedad Colectiva</Value>
            </Row>
            <Row>
              <Value column="id">4</Value>
              <Value column="description">Closed Corporation</Value>
              <Value column="es_description">Sociedad Anónima Cerrada</Value>
            </Row>
            <Row>
              <Value column="id">5</Value>
              <Value column="description">Open Stock Coporation</Value>
              <Value column="es_description">Sociedad Anónima Abierta</Value>
            </Row>
            <Row>
              <Value column="id">6</Value>
              <Value column="description">Cooperative</Value>
              <Value column="es_description">Cooperativa</Value>
            </Row>
            <Row>
              <Value column="id">7</Value>
              <Value column="description">State-owned</Value>
              <Value column="es_description">Pública</Value>
            </Row>
            <Row>
              <Value column="id">8</Value>
              <Value column="description">Joint-stock company</Value>
              <Value column="es_description">Sociedad por Acciones</Value>
            </Row>
            <Row>
              <Value column="id">9</Value>
              <Value column="description">Single-owner limited liability company</Value>
              <Value column="es_description">EIRL</Value>
            </Row>
            <Row>
              <Value column="id">10</Value>
              <Value column="description">Other</Value>
              <Value column="es_description">Other</Value>
            </Row>
          </Rows>
        </InlineTable>
        <Level name="Business Type" column="id" nameColumn="description" uniqueMembers="true">
          <Annotations>
            <Annotation name="es_caption">Description ES</Annotation>
          </Annotations>
          <Property name="Description ES" column="es_description" />
        </Level>
      </Hierarchy>
    </Dimension>

    <Dimension name="Ownership Type" foreignKey="forma_propiedad">
      <Hierarchy hasAll="true">
        <InlineTable alias="ownership_type">
          <ColumnDefs>
            <ColumnDef name="id" type="Numeric"/>
            <ColumnDef name="description" type="String"/>
            <ColumnDef name="es_description" type="String"/>
          </ColumnDefs>
          <Rows>
            <Row>
              <Value column="id">1</Value>
              <Value column="description">Private Domestic</Value>
              <Value column="es_description">Privada Nacional</Value>
            </Row>
            <Row>
              <Value column="id">2</Value>
              <Value column="description">Private Foreign</Value>
              <Value column="es_description">Privada Extranjera</Value>
            </Row>
            <Row>
              <Value column="id">3</Value>
              <Value column="description">Mixed</Value>
              <Value column="es_description">Mixta</Value>
            </Row>
            <Row>
              <Value column="id">4</Value>
              <Value column="description">State-owned</Value>
              <Value column="es_description">Estatal</Value>
            </Row>
          </Rows>
        </InlineTable>
        <Level name="Ownership Type" column="id" nameColumn="description" uniqueMembers="true">
          <Annotations>
            <Annotation name="es_caption">Description ES</Annotation>
          </Annotations>
          <Property name="Description ES" column="es_description" />
        </Level>
      </Hierarchy>
    </Dimension>

    <Measure name="sales" column="ventas" visible="true" aggregator="sum" />
    <Measure name="exports" column="exportaciones" visible="true" aggregator="sum" />
    <Measure name="Total Spending" column="gasto_total" visible="true" aggregator="sum" />

    <!-- expenditure by region -->
    <Measure name="gasto_I_TARAPACA" column="gasto_I_TARAPACA" visible="true" aggregator="sum" />
    <Measure name="gasto_II_ANTOFAGASTA" column="gasto_II_ANTOFAGASTA" visible="true" aggregator="sum" />
    <Measure name="gasto_III_ATACAMA" column="gasto_III_ATACAMA" visible="true" aggregator="sum" />
    <Measure name="gasto_IV_COQUIMBO" column="gasto_IV_COQUIMBO" visible="true" aggregator="sum" />
    <Measure name="gasto_V_VALPARAISO" column="gasto_V_VALPARAISO" visible="true" aggregator="sum" />
    <Measure name="gasto_VI_OHIGGINS" column="gasto_VI_OHIGGINS" visible="true" aggregator="sum" />
    <Measure name="gasto_VII_MAULE" column="gasto_VII_MAULE" visible="true" aggregator="sum" />
    <Measure name="gasto_VIII_BIOBIO" column="gasto_VIII_BIOBIO" visible="true" aggregator="sum" />
    <Measure name="gasto_IX_ARAUCANIA" column="gasto_IX_ARAUCANIA" visible="true" aggregator="sum" />
    <Measure name="gasto_XIV_RIOS" column="gasto_XIV_RIOS" visible="true" aggregator="sum" />
    <Measure name="gasto_X_LAGOS" column="gasto_X_LAGOS" visible="true" aggregator="sum" />
    <Measure name="gasto_XI_AYSEN" column="gasto_XI_AYSEN" visible="true" aggregator="sum" />
    <Measure name="gasto_XII_MAGALLANES" column="gasto_XII_MAGALLANES" visible="true" aggregator="sum" />
    <Measure name="gasto_XIII_METROPOLITANA" column="gasto_XIII_METROPOLITANA" visible="true" aggregator="sum" />

    <!-- staff by region -->
    <Measure name="staff_I_TARAPACA" column="personal_73" visible="true" aggregator="sum" />
    <Measure name="staff_II_ANTOFAGASTA" column="personal_74" visible="true" aggregator="sum" />
    <Measure name="staff_III_ATACAMA" column="personal_75" visible="true" aggregator="sum" />
    <Measure name="staff_IV_COQUIMBO" column="personal_76" visible="true" aggregator="sum" />
    <Measure name="staff_V_VALPARAISO" column="personal_77" visible="true" aggregator="sum" />
    <Measure name="staff_VI_OHIGGINS" column="personal_78" visible="true" aggregator="sum" />
    <Measure name="staff_VII_MAULE" column="personal_79" visible="true" aggregator="sum" />
    <Measure name="staff_VIII_BIOBIO" column="personal_80" visible="true" aggregator="sum" />
    <Measure name="staff_IX_ARAUCANIA" column="personal_81" visible="true" aggregator="sum" />
    <Measure name="staff_XIV_RIOS" column="personal_82" visible="true" aggregator="sum" />
    <Measure name="staff_X_LAGOS" column="personal_82" visible="true" aggregator="sum" />
    <Measure name="staff_XI_AYSEN" column="personal_84" visible="true" aggregator="sum" />
    <Measure name="staff_XII_MAGALLANES" column="personal_85" visible="true" aggregator="sum" />
    <Measure name="staff_XIII_METROPOLITANA" column="personal_86" visible="true" aggregator="sum" />
  </Cube>

  <Cube name="income_gini">
    <Table name="fact_income_gini" schema="economy" />

    <DimensionUsage name="Date" source="Date" foreignKey="date_id" />
    <DimensionUsage name="Geography" source="Geography" foreignKey="comuna_datachile_id" />

    <Measure name="region_mean_income" column="region_mean_income" visible="false" aggregator="min" />
    <Measure name="region_median_income" column="median_income" visible="false" aggregator="min" />
    <Measure name="region_gini_income" column="region_gini_income" visible="false" aggregator="min" />
    <Measure name="comuna_mean_income" column="comuna_mean_income" visible="false" aggregator="min" />
    <Measure name="comuna_median_income" column="comuna_median_income" visible="false" aggregator="min" />
    <Measure name="comuna_gini_income" column="comuna_gini_income" visible="false" aggregator="min" />

    <Measure name="region_ci_mean_income_lower" column="region_ci_mean_income_lower" visible="false" aggregator="min" />
    <Measure name="region_ci_mean_income_upper" column="region_ci_mean_income_upper" visible="false" aggregator="min" />
    <Measure name="region_ci_median_income_lower" column="region_ci_median_income_lower" visible="false" aggregator="min" />
    <Measure name="region_ci_median_income_upper" column="region_ci_median_income_upper" visible="false" aggregator="min" />
    <Measure name="region_ci_gini_income_lower" column="region_ci_gini_income_lower" visible="false" aggregator="min" />
    <Measure name="region_ci_gini_income_upper" column="region_ci_gini_income_upper" visible="false" aggregator="min" />
    <Measure name="comuna_ci_mean_income_lower" column="comuna_ci_mean_income_lower" visible="false" aggregator="min" />
    <Measure name="comuna_ci_mean_income_upper" column="comuna_ci_mean_income_upper" visible="false" aggregator="min" />
    <Measure name="comuna_ci_median_income_lower" column="comuna_ci_median_income_lower" visible="false" aggregator="min" />
    <Measure name="comuna_ci_median_income_upper" column="comuna_ci_median_income_upper" visible="false" aggregator="min" />
    <Measure name="comuna_ci_gini_income_lower" column="comuna_ci_gini_income_lower" visible="false" aggregator="min" />
    <Measure name="comuna_ci_gini_income_upper" column="comuna_ci_gini_income_upper" visible="false" aggregator="min" />

    <!-- This is a hackish way of implementing non-additive measures
         Taken from: http://forums.pentaho.com/showthread.php?65993-Support-for-non-additive-and-semi-additive-measures&p=202196#post202196 -->
    <CalculatedMember name="Mean Income" dimension="Measures">
      <Formula>
        CASE WHEN [Date].Level is [Date].Year
        THEN
          CASE
            WHEN [Geography].Level is [Geography].[Region] THEN [Measures].[region_mean_income]
            WHEN [Geography].Level is [Geography].[Comuna] THEN [Measures].[comuna_mean_income]
            ELSE Null
          END
        ELSE Null
        END
      </Formula>
    </CalculatedMember>

    <CalculatedMember name="Median Income" dimension="Measures">
      <Formula>
        CASE WHEN [Date].Level is [Date].Year
        THEN
          CASE
            WHEN [Geography].Level is [Geography].[Region] THEN [Measures].[region_median_income]
            WHEN [Geography].Level is [Geography].[Comuna] THEN [Measures].[comuna_median_income]
            ELSE Null
          END
        ELSE Null
        END
      </Formula>
    </CalculatedMember>

    <CalculatedMember name="Gini" dimension="Measures">
      <Formula>
        CASE WHEN [Date].Level is [Date].Year
        THEN
          CASE
            WHEN [Geography].Level is [Geography].[Region] THEN [Measures].[region_gini_income]
            WHEN [Geography].Level is [Geography].[Comuna] THEN [Measures].[comuna_gini_income]
            ELSE Null
          END
        ELSE Null
        END
      </Formula>
    </CalculatedMember>
  </Cube>

  <Cube name="nene">
    <Table name="fact_occupational_status_nene" schema="economy" />
    <DimensionUsage name="Date" source="Date" foreignKey="date_id" />
    <DimensionUsage name="Sex" source="Sex" foreignKey="sex_id" />
    <Dimension name="ISCED" foreignKey="isced_id">
      <Hierarchy hasAll="true">
        <InlineTable alias="isced">
          <ColumnDefs>
            <ColumnDef name="id" type="Numeric" />
            <ColumnDef name="description" type="String" />
            <ColumnDef name="es_description" type="String" />
          </ColumnDefs>
          <Rows>
            <Row>
              <Value column="id">1</Value>
              <Value column="description">Doctorado</Value>
              <Value column="es_description">Doctorado</Value>
            </Row>
            <Row>
              <Value column="id">2</Value>
              <Value column="description">Educación Preescolar</Value>
              <Value column="es_description">Educación Preescolar</Value>
            </Row>
            <Row>
              <Value column="id">3</Value>
              <Value column="description">Educación Primaria (nivel 1)</Value>
              <Value column="es_description">Educación Primaria (nivel 1)</Value>
            </Row>
            <Row>
              <Value column="id">4</Value>
              <Value column="description">Educación Primaria (nivel 2)</Value>
              <Value column="es_description">Educación Primaria (nivel 2)</Value>
            </Row>
            <Row>
              <Value column="id">5</Value>
              <Value column="description">Educación Secundaria</Value>
              <Value column="es_description">Educación Secundaria</Value>
            </Row>
            <Row>
              <Value column="id">6</Value>
              <Value column="description">Educación Técnica (Educación Superior no Universitaria)</Value>
              <Value column="es_description">Educación Técnica (Educación Superior no Universitaria)</Value>
            </Row>
            <Row>
              <Value column="id">7</Value>
              <Value column="description">Educación Universitaria</Value>
              <Value column="es_description">Educación Universitaria</Value>
            </Row>
            <Row>
              <Value column="id">8</Value>
              <Value column="description">Nivel ignorado</Value>
              <Value column="es_description">Nivel ignorado</Value>
            </Row>
            <Row>
              <Value column="id">9</Value>
              <Value column="description">Nunca estudió</Value>
              <Value column="es_description">Nunca estudió</Value>
            </Row>
            <Row>
              <Value column="id">10</Value>
              <Value column="description">Postítulo y Maestría</Value>
              <Value column="es_description">Postítulo y Maestría</Value>
            </Row>
            <Row>
              <Value column="id">0</Value>
              <Value column="description">No sabe/No responde</Value>
              <Value column="es_description">No sabe/No responde</Value>
            </Row>
          </Rows>
        </InlineTable>
        <Level name="ISCED" column="id" nameColumn="description" uniqueMembers="true">
          <Annotations>
            <Annotation name="es_caption">Description ES</Annotation>
          </Annotations>
          <Property name="Description ES" column="es_description" />
        </Level>
      </Hierarchy>
    </Dimension>

    <Dimension name="icse" foreignKey="icse_id">
      <Hierarchy hasAll="true">
        <InlineTable alias="icse">
          <ColumnDefs>
            <ColumnDef name="id" type="Numeric" />
            <ColumnDef name="description" type="String" />
            <ColumnDef name="es_description" type="String" />
          </ColumnDefs>
          <Rows>
            <Row>
              <Value column="id">1</Value>
              <Value column="description">Asalariado Sector Privado</Value>
              <Value column="es_description">Asalariado Sector Privado</Value>
            </Row>
            <Row>
              <Value column="id">2</Value>
              <Value column="description">Asalariado Sector Público</Value>
              <Value column="es_description">Asalariado Sector Público</Value>
            </Row>
            <Row>
              <Value column="id">3</Value>
              <Value column="description">Cuenta Propia</Value>
              <Value column="es_description">Cuenta Propia</Value>
            </Row>
            <Row>
              <Value column="id">4</Value>
              <Value column="description">Empleador</Value>
              <Value column="es_description">Empleador</Value>
            </Row>
            <Row>
              <Value column="id">5</Value>
              <Value column="description">Personal de Servicio Doméstico Puertas Adentro</Value>
              <Value column="es_description">Personal de Servicio Doméstico Puertas Adentro</Value>
            </Row>
            <Row>
              <Value column="id">6</Value>
              <Value column="description">Personal de Servicio Doméstico Puertas Afuera</Value>
              <Value column="es_description">Personal de Servicio Doméstico Puertas Afuera</Value>
            </Row>
            <Row>
              <Value column="id">0</Value>
              <Value column="description">No sabe/No responde</Value>
              <Value column="es_description">No sabe/No responde</Value>
            </Row>
          </Rows>
        </InlineTable>
        <Level name="ICSE" column="id" nameColumn="description" uniqueMembers="true">
          <Annotations>
            <Annotation name="es_caption">Description ES</Annotation>
          </Annotations>
          <Property name="Description ES" column="es_description" />
        </Level>
      </Hierarchy>
    </Dimension>

    <Dimension name="isco" foreignKey="isco_id">
      <Hierarchy hasAll="true">
        <InlineTable alias="isco">
          <ColumnDefs>
            <ColumnDef name="id" type="Numeric" />
            <ColumnDef name="description" type="String" />
            <ColumnDef name="es_description" type="String" />
          </ColumnDefs>
          <Rows>
            <Row>
              <Value column="id">1</Value>
              <Value column="description">Agricultores y trabajadores calificados agropecuarios y pesqueros</Value>
              <Value column="es_description">Agricultores y trabajadores calificados agropecuarios y pesqueros</Value>
            </Row>
            <Row>
              <Value column="id">2</Value>
              <Value column="description">Empleados de oficina</Value>
              <Value column="es_description">Empleados de oficina</Value>
            </Row>
            <Row>
              <Value column="id">3</Value>
              <Value column="description">Funcionarios públicos y personal directivo de la administración pública y empresas</Value>
              <Value column="es_description">Funcionarios públicos y personal directivo de la administración pública y empresas</Value>
            </Row>
            <Row>
              <Value column="id">4</Value>
              <Value column="description">Oficiales, operarios y artesanos de artes mecánicas y de otros oficios</Value>
              <Value column="es_description">Oficiales, operarios y artesanos de artes mecánicas y de otros oficios</Value>
            </Row>
            <Row>
              <Value column="id">5</Value>
              <Value column="description">Operadores de instalaciones y máquinas y montadores</Value>
              <Value column="es_description">Operadores de instalaciones y máquinas y montadores</Value>
            </Row>
            <Row>
              <Value column="id">6</Value>
              <Value column="description">Otros no identificados</Value>
              <Value column="es_description">Otros no identificados</Value>
            </Row>
            <Row>
              <Value column="id">7</Value>
              <Value column="description">Profesionales científicos e intelectuales</Value>
              <Value column="es_description">Profesionales científicos e intelectuales</Value>
            </Row>
            <Row>
              <Value column="id">8</Value>
              <Value column="description">Técnicos y profesionales de nivel medio</Value>
              <Value column="es_description">Técnicos y profesionales de nivel medio</Value>
            </Row>
            <Row>
              <Value column="id">9</Value>
              <Value column="description">Trabajadores de los servicios y vendedores de comercios y mercados</Value>
              <Value column="es_description">Trabajadores de los servicios y vendedores de comercios y mercados</Value>
            </Row>
            <Row>
              <Value column="id">10</Value>
              <Value column="description">Trabajadores no calificados</Value>
              <Value column="es_description">Trabajadores no calificados</Value>
            </Row>
            <Row>
              <Value column="id">0</Value>
              <Value column="description">No sabe/No responde</Value>
              <Value column="es_description">No sabe/No responde</Value>
            </Row>
          </Rows>
        </InlineTable>
        <Level name="ISCO" column="id" nameColumn="description" uniqueMembers="true">
          <Annotations>
            <Annotation name="es_caption">Description ES</Annotation>
          </Annotations>
          <Property name="Description ES" column="es_description" />
        </Level>
      </Hierarchy>
    </Dimension>

    <Dimension name="Age Range" foreignKey="age_range_id">
      <Hierarchy hasAll="true">
        <InlineTable alias="age_ranges">
          <ColumnDefs>
            <ColumnDef name="id" type="Numeric" />
            <ColumnDef name="description" type="String" />
            <ColumnDef name="es_description" type="String" />
          </ColumnDefs>
          <Rows>
            <Row>
              <Value column="id">1</Value>
              <Value column="description">15 a 19</Value>
              <Value column="es_description">15 a 19</Value>
            </Row>
            <Row>
              <Value column="id">2</Value>
              <Value column="description">20 a 24</Value>
              <Value column="es_description">20 a 24</Value>
            </Row>
            <Row>
              <Value column="id">3</Value>
              <Value column="description">25 a 29</Value>
              <Value column="es_description">25 a 29</Value>
            </Row>
            <Row>
              <Value column="id">4</Value>
              <Value column="description">30 a 65</Value>
              <Value column="es_description">30 a 65</Value>
            </Row>
            <Row>
              <Value column="id">5</Value>
              <Value column="description">65 a maxima edad de encuestados</Value>
              <Value column="es_description">65 a maxima edad de encuestados</Value>
            </Row>
          </Rows>
        </InlineTable>
        <Level name="Age Range" column="id" nameColumn="description" uniqueMembers="true">
          <Annotations>
            <Annotation name="es_caption">Description ES</Annotation>
          </Annotations>
          <Property name="Description ES" column="es_description" />
        </Level>
      </Hierarchy>
    </Dimension>

    <Dimension name="Occupational Situation" foreignKey="occupied_id">
      <Hierarchy hasAll="true">
        <InlineTable alias="occupational_situation">
          <ColumnDefs>
            <ColumnDef name="id" type="Numeric" />
            <ColumnDef name="description" type="String" />
            <ColumnDef name="es_description" type="String" />
          </ColumnDefs>
          <Rows>
            <Row>
              <Value column="id">1</Value>
              <Value column="description">Ocupado</Value>
              <Value column="es_description">Ocupado</Value>
            </Row>
            <Row>
              <Value column="id">2</Value>
              <Value column="description">Desocupado</Value>
              <Value column="es_description">Desocupado</Value>
            </Row>
            <Row>
              <Value column="id">3</Value>
              <Value column="description">Inactivo</Value>
              <Value column="es_description">Inactivo</Value>
            </Row>
          </Rows>
        </InlineTable>
        <Level name="Occupational Situation" column="id" nameColumn="description" uniqueMembers="true">
          <Annotations>
            <Annotation name="es_caption">Description ES</Annotation>
          </Annotations>
          <Property name="Description ES" column="es_description" />
        </Level>
      </Hierarchy>
    </Dimension>

    <Dimension name="General Economic Condition" foreignKey="general_economic_condition">
      <Hierarchy hasAll="true">
        <InlineTable alias="general_economic_condition">
          <ColumnDefs>
            <ColumnDef name="id" type="Numeric" />
            <ColumnDef name="description" type="String" />
            <ColumnDef name="es_description" type="String" />
          </ColumnDefs>
          <Rows>
            <Row>
              <Value column="id">0</Value>
              <Value column="description">Menor de 15 años</Value>
              <Value column="es_description">Menor de 15 años</Value>
            </Row>
            <Row>
              <Value column="id">1</Value>
              <Value column="description">Ocupado tradicional</Value>
              <Value column="es_description">Ocupado tradicional</Value>
            </Row>
            <Row>
              <Value column="id">2</Value>
              <Value column="description">Ocupado notradicional</Value>
              <Value column="es_description">Ocupado notradicional</Value>
            </Row>
            <Row>
              <Value column="id">3</Value>
              <Value column="description">Ocupado ausente</Value>
              <Value column="es_description">Ocupado ausente</Value>
            </Row>
            <Row>
              <Value column="id">4</Value>
              <Value column="description">Cesante</Value>
              <Value column="es_description">Cesante</Value>
            </Row>
            <Row>
              <Value column="id">5</Value>
              <Value column="description">Busca trabajo por primera vez</Value>
              <Value column="es_description">Busca trabajo por primera vez</Value>
            </Row>
            <Row>
              <Value column="id">6</Value>
              <Value column="description">Iniciador</Value>
              <Value column="es_description">Iniciador</Value>
            </Row>
            <Row>
              <Value column="id">7</Value>
              <Value column="description">Inactivos que buscaron trabajo</Value>
              <Value column="es_description">Inactivos que buscaron trabajo</Value>
            </Row>
            <Row>
              <Value column="id">8</Value>
              <Value column="description">Inactivos que estuvieron disponibles para trabajar</Value>
              <Value column="es_description">Inactivos que estuvieron disponibles para trabajar</Value>
            </Row>
            <Row>
              <Value column="id">9</Value>
              <Value column="description">Inactivos que no buscaron trabajo ni estuvieron disponibles</Value>
              <Value column="es_description">Inactivos que no buscaron trabajo ni estuvieron disponibles</Value>
            </Row>
          </Rows>
        </InlineTable>
        <Level name="General Economic Condition" column="id" nameColumn="description" uniqueMembers="true">
          <Annotations>
            <Annotation name="es_caption">Description ES</Annotation>
          </Annotations>
          <Property name="Description ES" column="es_description" />
        </Level>
      </Hierarchy>
    </Dimension>

    <Measure name="Number of records" column="date_id" aggregator="count" visible="true" />
    <Measure name="Expansion factor" column="fact" aggregator="sum" visible="true" />
    <Measure name="Weighted Value" dataType="Numeric" aggregator="None" visible="true" >
      <MeasureExpression>
        <SQL>(sum(count(*) * fact) / sum(fact))</SQL>
      </MeasureExpression>
    </Measure>
    <!-- CalculatedMember name="Weighted Value" dimension="Measures" visible="true">
      <Formula>([Measures].[Number of records] * [Measures].[Expansion factor]) / [Measures].[Expansion factor]</Formula>
    </CalculatedMember -->
  </Cube>


  <VirtualCube name="exports_and_imports">
    <VirtualCubeDimension name="Date" />
    <VirtualCubeDimension name="Geography" />

    <VirtualCubeMeasure cubeName="exports" name="[Measures].[FOB US]" visible="false" />
    <VirtualCubeMeasure cubeName="imports" name="[Measures].[CIF US]" visible="false" />

    <CalculatedMember name="FOB" dimension="Measures" visible="true">
      <Formula>ValidMeasure([Measures].[FOB US])</Formula>
    </CalculatedMember>

    <CalculatedMember name="CIF" dimension="Measures" visible="true">
      <Formula>ValidMeasure([Measures].[CIF US])</Formula>
    </CalculatedMember>

    <CalculatedMember name="Trade Balance" dimension="Measures" visible="true">
      <Formula>([Measures].[FOB US] - [Measures].[CIF US])</Formula>
    </CalculatedMember>
  </VirtualCube>
</Schema>
